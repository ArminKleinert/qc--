
# ------------------------------------------------------------------ 
# paths
# ------------------------------------------------------------------ 

LIBDIR =    ../lib
BINDIR =    ../bin
MANDIR =    ../man

# ------------------------------------------------------------------  
# high level targets
# ------------------------------------------------------------------  

test:VQ:        ../bin/qc-- fp regr
                for f in *.c--; do
                    grep '^///' $f | sed 's+^///++' | sh || true
                done
# ------------------------------------------------------------------ 
# useful targets to create test results
# ------------------------------------------------------------------ 

%.2:            %.c--
                ../bin/qc-- -check $prereq 2> $target || true

%.test:V:       %.c--         
                grep '^///' $prereq | sed 's+^///++' | sh || true

# ------------------------------------------------------------------ 
# Noweb stuff - once this is stable the generic part should go to
# ../config/noweb.mk
# ------------------------------------------------------------------ 

NOWEAVE =       noweave
NOTANGLE =      notangle
CPIF =          cpif
RERUN =         Rerun (LaTeX|to get cross-references right)

LINE =          '# %L "%F"%N'
OCAMLTANGLE =   'for f in $target; do $NOTANGLE -L"$LINE" -R$f $prereq | $CPIF $f; done'
MISCTANGLE  =   'for f in $target; do $NOTANGLE -R$f $prereq | $CPIF $f; done'

HTML =          `echo *.nw       | sed 's/\.nw/.html/g;'`

%.inc:          %.nw
                $NOWEAVE -delay $prereq > $target

%.html:         %.nw
                $NOWEAVE -delay -html -filter l2h $prereq > $target

# ------------------------------------------------------------------  
# sources generated from noweb sources
# ------------------------------------------------------------------  

fp              \
regr:           test.nw
                eval $MISCTANGLE
                chmod +x $target

html:V:         $HTML
